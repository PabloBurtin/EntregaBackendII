<div class="container mt-4" data-cart-id="{{cart._id}}">
  <h1 class="mb-4">Mi Carrito</h1>
  
  {{!-- Mostrar mensajes --}}
  {{#if query.success}}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      {{query.success}}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {{/if}}
  {{#if query.error}}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      {{query.error}}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {{/if}}
  
  {{#if cart.products.length}}
    <div class="row">
      {{#each cart.products}}
        <div class="col-md-4 mb-4">
          <div class="card h-100">
            <img src="{{this.product.thumbnail}}" class="card-img-top" alt="{{this.product.title}}" style="height: 180px; object-fit: cover;">
            <div class="card-body">
              <h5 class="card-title">{{this.product.title}}</h5>
              <p class="card-text">${{this.product.price}} c/u</p>
              <p class="card-text">Cantidad: {{this.quantity}}</p>
              <p class="card-text">Total: ${{this.itemTotal}}</p>
              
              {{!-- Eliminar producto --}}
              <button class="btn btn-danger btn-sm" onclick="cartManager.deleteProduct('{{../cart._id}}', '{{this.product._id}}')">
                Eliminar
              </button>
              
              {{!-- Actualizar cantidad --}}
              <div class="input-group input-group-sm mt-2">
                <input type="number" id="quantity-{{this.product._id}}" value="{{this.quantity}}" min="1" class="form-control" style="width: 70px;">
                <button type="button" class="btn btn-outline-primary" onclick="cartManager.updateQuantity('{{../cart._id}}', '{{this.product._id}}')">
                  Actualizar
                </button>
              </div>
            </div>
          </div>
        </div>
      {{/each}}
    </div>

    <div class="text-end mt-4">
      <h4>Total del carrito: ${{cart.cartTotal}}</h4>
      
      {{!-- Vaciar carrito --}}
      <button class="btn btn-warning me-2" onclick="cartManager.emptyCart('{{cart._id}}')">
        Vaciar Carrito
      </button>
      
      {{!-- Eliminar carrito --}}
      <button class="btn btn-danger me-2" onclick="cartManager.deleteCart('{{cart._id}}')">
        Eliminar Carrito
      </button>
      
      <a href="/products" class="btn btn-secondary me-2">Seguir comprando</a>
      <button class="btn btn-success">Finalizar compra</button>
    </div>
  {{else}}
    <div class="alert alert-info">
      <p>Tu carrito está vacío</p>
      <a href="/products" class="btn btn-primary">Ver productos</a>
    </div>
  {{/if}}
</div>

<a href="/products" class="btn btn-link mt-3">← Volver a productos</a>

{{!-- Incluir el script externo --}}
<script src="/js/cartManager.js"></script>